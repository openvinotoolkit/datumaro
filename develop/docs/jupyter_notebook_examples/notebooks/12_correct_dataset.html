
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Correct datasets &#8212; Datumaro 1.3.0rc1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../../../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'docs/jupyter_notebook_examples/notebooks/12_correct_dataset';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../../index.html">

  
  
  
  
  
  
  

  
    <img src="../../../_static/datumaro-logo.png" class="logo__image only-light" alt="Logo image">
    <img src="../../../_static/datumaro-logo.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../index.html">
                        Docs
                      </a>
                    </li>
                
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/openvinotoolkit/datumaro" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><img src="../../../_static/github_icon.png" class="icon-link-image" alt="GitHub"/></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../index.html">
                        Docs
                      </a>
                    </li>
                
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/openvinotoolkit/datumaro" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><img src="../../../_static/github_icon.png" class="icon-link-image" alt="GitHub"/></a>
        </li>
      </ul>
      </div>
      
    </div>
    
  </div>

  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <section id="Correct-datasets">
<h1>Correct datasets<a class="headerlink" href="#Correct-datasets" title="Permalink to this heading">#</a></h1>
<p><a class="reference external" href="https://github.com/openvinotoolkit/datumaro/blob/develop/notebooks/12_correct_dataset.ipynb"><img alt="Jupyter Notebook" src="https://img.shields.io/badge/jupyter-%23FA0F00.svg?style=for-the-badge&amp;logo=jupyter&amp;logoColor=white" /></a></p>
<p>In this notebook example, we will demonstrate how to rectify a dataset using a pre-generated validation report. The report is designed to analyze various types of anomalies in the data, as shown in the previous <a class="reference external" href="https://github.com/openvinotoolkit/datumaro/blob/develop/notebooks/11_validate.ipynb">notebook example</a>. By leveraging this report, we can enhance the dataset by addressing issues like undefined labels, missing annotations, and statistical outliers.</p>
<section id="Prerequisite">
<h2>Prerequisite<a class="headerlink" href="#Prerequisite" title="Permalink to this heading">#</a></h2>
<section id="Download-COCO-2017-validation-dataset">
<h3>Download COCO 2017 validation dataset<a class="headerlink" href="#Download-COCO-2017-validation-dataset" title="Permalink to this heading">#</a></h3>
<p>Please refer <a class="reference external" href="https://openvinotoolkit.github.io/datumaro/latest/docs/jupyter_notebook_examples/notebooks/03_visualize.html">this notebook</a> for preparing COCO 2017 validation dataset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datumaro.components.dataset</span> <span class="kn">import</span> <span class="n">Dataset</span>

<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;coco_dataset&quot;</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">import_from</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;coco_instances&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Representation for sample COCO dataset&quot;</span><span class="p">)</span>
<span class="n">dataset</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING:root:File &#39;coco_dataset/annotations/panoptic_val2017.json&#39; was skipped, could&#39;t match this file with any of these tasks: coco_instances
WARNING:root:File &#39;coco_dataset/annotations/person_keypoints_val2017.json&#39; was skipped, could&#39;t match this file with any of these tasks: coco_instances
WARNING:root:File &#39;coco_dataset/annotations/captions_val2017.json&#39; was skipped, could&#39;t match this file with any of these tasks: coco_instances
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Representation for sample COCO dataset
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dataset
        size=5000
        source_path=coco_dataset
        media_type=&lt;class &#39;datumaro.components.media.Image&#39;&gt;
        annotated_items_count=4952
        annotations_count=78647
subsets
        val2017: # of items=5000, # of annotated items=4952, # of annotations=78647, annotation types=[&#39;polygon&#39;, &#39;bbox&#39;, &#39;mask&#39;]
infos
        categories
        label: [&#39;person&#39;, &#39;bicycle&#39;, &#39;car&#39;, &#39;motorcycle&#39;, &#39;airplane&#39;, &#39;bus&#39;, &#39;train&#39;, &#39;truck&#39;, &#39;boat&#39;, &#39;traffic light&#39;, &#39;fire hydrant&#39;, &#39;stop sign&#39;, &#39;parking meter&#39;, &#39;bench&#39;, &#39;bird&#39;, &#39;cat&#39;, &#39;dog&#39;, &#39;horse&#39;, &#39;sheep&#39;, &#39;cow&#39;, &#39;elephant&#39;, &#39;bear&#39;, &#39;zebra&#39;, &#39;giraffe&#39;, &#39;backpack&#39;, &#39;umbrella&#39;, &#39;handbag&#39;, &#39;tie&#39;, &#39;suitcase&#39;, &#39;frisbee&#39;, &#39;skis&#39;, &#39;snowboard&#39;, &#39;sports ball&#39;, &#39;kite&#39;, &#39;baseball bat&#39;, &#39;baseball glove&#39;, &#39;skateboard&#39;, &#39;surfboard&#39;, &#39;tennis racket&#39;, &#39;bottle&#39;, &#39;wine glass&#39;, &#39;cup&#39;, &#39;fork&#39;, &#39;knife&#39;, &#39;spoon&#39;, &#39;bowl&#39;, &#39;banana&#39;, &#39;apple&#39;, &#39;sandwich&#39;, &#39;orange&#39;, &#39;broccoli&#39;, &#39;carrot&#39;, &#39;hot dog&#39;, &#39;pizza&#39;, &#39;donut&#39;, &#39;cake&#39;, &#39;chair&#39;, &#39;couch&#39;, &#39;potted plant&#39;, &#39;bed&#39;, &#39;dining table&#39;, &#39;toilet&#39;, &#39;tv&#39;, &#39;laptop&#39;, &#39;mouse&#39;, &#39;remote&#39;, &#39;keyboard&#39;, &#39;cell phone&#39;, &#39;microwave&#39;, &#39;oven&#39;, &#39;toaster&#39;, &#39;sink&#39;, &#39;refrigerator&#39;, &#39;book&#39;, &#39;clock&#39;, &#39;vase&#39;, &#39;scissors&#39;, &#39;teddy bear&#39;, &#39;hair drier&#39;, &#39;toothbrush&#39;]
</pre></div></div>
</div>
</section>
<section id="Generate-the-validation-report">
<h3>Generate the validation report<a class="headerlink" href="#Generate-the-validation-report" title="Permalink to this heading">#</a></h3>
<p>As following the previous example, we then generate the validation report per severity (error, warning, and info) and various anomaly types. In this example, we are going to resolve the errors and warnings through <code class="docutils literal notranslate"><span class="pre">correct</span></code> transformation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datumaro.plugins.validators</span> <span class="kn">import</span> <span class="n">DetectionValidator</span>

<span class="n">extra_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;few_samples_thr&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s2">&quot;imbalance_ratio_thr&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;far_from_mean_thr&quot;</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">validator</span> <span class="o">=</span> <span class="n">DetectionValidator</span><span class="p">(</span><span class="o">**</span><span class="n">extra_args</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">dataset</span><span class="p">):</span>
    <span class="n">reports</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Validation report summary:&quot;</span><span class="p">,</span> <span class="n">reports</span><span class="p">[</span><span class="s2">&quot;summary&quot;</span><span class="p">])</span>

    <span class="n">error_cnt</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">warning_cnt</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">info_cnt</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">report</span> <span class="ow">in</span> <span class="n">reports</span><span class="p">[</span><span class="s2">&quot;validation_reports&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="s2">&quot;severity&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="n">report</span><span class="p">[</span><span class="s2">&quot;anomaly_type&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">error_cnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">error_cnt</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">error_cnt</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="s2">&quot;severity&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;warning&quot;</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="n">report</span><span class="p">[</span><span class="s2">&quot;anomaly_type&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">warning_cnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">warning_cnt</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warning_cnt</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="s2">&quot;severity&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;info&quot;</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="n">report</span><span class="p">[</span><span class="s2">&quot;anomaly_type&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">info_cnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">info_cnt</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">info_cnt</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The number of reports per error type: &quot;</span><span class="p">,</span> <span class="n">error_cnt</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The number of reports per warning type: &quot;</span><span class="p">,</span> <span class="n">warning_cnt</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The number of reports per info type: &quot;</span><span class="p">,</span> <span class="n">info_cnt</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">reports</span>


<span class="n">reports</span> <span class="o">=</span> <span class="n">validate</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Validation report summary: {&#39;errors&#39;: 36782, &#39;warnings&#39;: 105, &#39;infos&#39;: 69}
The number of reports per error type:  {&#39;UndefinedAttribute&#39;: 36781, &#39;NegativeLength&#39;: 1}
The number of reports per warning type:  {&#39;MissingAnnotation&#39;: 48, &#39;FarFromLabelMean&#39;: 57}
The number of reports per info type:  {&#39;FewSamplesInLabel&#39;: 9, &#39;ImbalancedLabels&#39;: 1, &#39;ImbalancedDistInLabel&#39;: 59}
</pre></div></div>
</div>
</section>
<section id="Visualize-some-anomalies">
<h3>Visualize some anomalies<a class="headerlink" href="#Visualize-some-anomalies" title="Permalink to this heading">#</a></h3>
<p>Let’s visually check how serious the abnormal samples are for a few examples.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datumaro.components.annotation</span> <span class="kn">import</span> <span class="n">AnnotationType</span>
<span class="kn">from</span> <span class="nn">datumaro.components.visualizer</span> <span class="kn">import</span> <span class="n">Visualizer</span>

<span class="n">far_from_mean_ids</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">far_from_mean_subsets</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">report</span> <span class="ow">in</span> <span class="n">reports</span><span class="p">[</span><span class="s2">&quot;validation_reports&quot;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="s2">&quot;anomaly_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;FarFromLabelMean&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="s2">&quot;item_id&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">far_from_mean_ids</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">far_from_mean_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;item_id&quot;</span><span class="p">])</span>
        <span class="n">far_from_mean_subsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;subset&quot;</span><span class="p">])</span>

<span class="n">visualizer</span> <span class="o">=</span> <span class="n">Visualizer</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">ignored_types</span><span class="o">=</span><span class="p">[</span><span class="n">AnnotationType</span><span class="o">.</span><span class="n">mask</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">visualizer</span><span class="o">.</span><span class="n">vis_gallery</span><span class="p">(</span><span class="n">far_from_mean_ids</span><span class="p">[:</span><span class="mi">8</span><span class="p">],</span> <span class="n">far_from_mean_subsets</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING:accuracy_checker:/home/wonju/datumaro/datumaro/components/visualizer.py:416: UserWarning: mask in self.ignored_types. Skip it.
  warnings.warn(msg)

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/docs_jupyter_notebook_examples_notebooks_12_correct_dataset_5_1.png" src="../../../_images/docs_jupyter_notebook_examples_notebooks_12_correct_dataset_5_1.png" />
</div>
</div>
</section>
</section>
<section id="Correct-anomalies">
<h2>Correct anomalies<a class="headerlink" href="#Correct-anomalies" title="Permalink to this heading">#</a></h2>
<p>Among the many transformations provided by Datumaro, <code class="docutils literal notranslate"><span class="pre">correct</span></code> transformation corrects anomalies as shown in the table below.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Anomaly type</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Task</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Target</p></th>
<th class="head"><p>Operation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MissingLabelCategories</p></td>
<td><p>Metadata (ex. LabelCategories) should be defined</p></td>
<td><p>common</p></td>
<td><p>error</p></td>
<td><p>category</p></td>
<td><p>add</p></td>
</tr>
<tr class="row-odd"><td><p>MissingAnnotation</p></td>
<td><p>No annotation found for an Item</p></td>
<td><p>common</p></td>
<td><p>warning</p></td>
<td><p>item</p></td>
<td><p>remove</p></td>
</tr>
<tr class="row-even"><td><p>MissingAttribute</p></td>
<td><p>An attribute key is missing for an Item</p></td>
<td><p>common</p></td>
<td><p>warning</p></td>
<td><p>item</p></td>
<td><p>add</p></td>
</tr>
<tr class="row-odd"><td><p>UndefinedLabel</p></td>
<td><p>A label not defined in the metadata is found for an item</p></td>
<td><p>common</p></td>
<td><p>error</p></td>
<td><p>category</p></td>
<td><p>add</p></td>
</tr>
<tr class="row-even"><td><p>UndefinedAttribute</p></td>
<td><p>An attribute not defined in the metadata is found for an item</p></td>
<td><p>common</p></td>
<td><p>error</p></td>
<td><p>category</p></td>
<td><p>add</p></td>
</tr>
<tr class="row-odd"><td><p>MultiLabelAnnotations</p></td>
<td><p>Item needs a single label</p></td>
<td><p>classification</p></td>
<td><p>error</p></td>
<td><p>item</p></td>
<td><p>remove</p></td>
</tr>
<tr class="row-even"><td><p>NegativeLength</p></td>
<td><p>The width or height of bounding box is negative</p></td>
<td><p>detection</p></td>
<td><p>error</p></td>
<td><p>ann</p></td>
<td><p>remove</p></td>
</tr>
<tr class="row-odd"><td><p>InvalidValue</p></td>
<td><p>There’s invalid (ex. inf, nan) value for bounding box info.</p></td>
<td><p>detection</p></td>
<td><p>error</p></td>
<td><p>ann</p></td>
<td><p>remove</p></td>
</tr>
<tr class="row-even"><td><p>FarFromLabelMean</p></td>
<td><p>An annotation has an too small or large value than average for a label</p></td>
<td><p>detection, segmentation</p></td>
<td><p>warning</p></td>
<td><p>ann</p></td>
<td><p>remove</p></td>
</tr>
<tr class="row-odd"><td><p>FarFromAttrMean</p></td>
<td><p>An annotation has an too small or large value than average for an attribute</p></td>
<td><p>detection, segmentation</p></td>
<td><p>warning</p></td>
<td><p>ann</p></td>
<td><p>remove</p></td>
</tr>
<tr class="row-even"><td><p>LabelDefinedButNotFound</p></td>
<td><p>A label is defined, but not found actually</p></td>
<td><p>common</p></td>
<td><p>warning</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>AttributeDefinedButNotFound</p></td>
<td><p>An attribute is defined, but not found actually</p></td>
<td><p>common</p></td>
<td><p>warning</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>OnlyOneLabel</p></td>
<td><p>The dataset consists of only label</p></td>
<td><p>common</p></td>
<td><p>info</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>OnlyOneAttributeValue</p></td>
<td><p>The dataset consists of only attribute value</p></td>
<td><p>common</p></td>
<td><p>info</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>FewSamplesInLabel</p></td>
<td><p>The number of samples in a label might be too low</p></td>
<td><p>common</p></td>
<td><p>info</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>FewSamplesInAttribute</p></td>
<td><p>The number of samples in an attribute might be too low</p></td>
<td><p>common</p></td>
<td><p>info</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>ImbalancedLabels</p></td>
<td><p>There is an imbalance in the label distribution</p></td>
<td><p>common</p></td>
<td><p>info</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>ImbalancedAttribute</p></td>
<td><p>There is an imbalance in the attribute distribution</p></td>
<td><p>common</p></td>
<td><p>info</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>ImbalancedDistInLabel</p></td>
<td><p>Values (ex. bbox width) are not evenly distributed for a label</p></td>
<td><p>detection, segmentation</p></td>
<td><p>info</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>ImbalancedDistInAttribute</p></td>
<td><p>Values (ex. bbox width) are not evenly distributed for an attribute</p></td>
<td><p>detection, segmentation</p></td>
<td><p>info</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datumaro.plugins.transforms</span> <span class="k">as</span> <span class="nn">transforms</span>

<span class="n">refined_dataset</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Correct</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">reports</span><span class="o">=</span><span class="n">reports</span><span class="p">)</span>

<span class="n">reports</span> <span class="o">=</span> <span class="n">validate</span><span class="p">(</span><span class="n">refined_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Validation report summary: {&#39;errors&#39;: 0, &#39;warnings&#39;: 58, &#39;infos&#39;: 281}
The number of reports per error type:  {}
The number of reports per warning type:  {&#39;MissingAnnotation&#39;: 1, &#39;FarFromLabelMean&#39;: 33, &#39;FarFromAttrMean&#39;: 24}
The number of reports per info type:  {&#39;FewSamplesInLabel&#39;: 9, &#39;ImbalancedLabels&#39;: 1, &#39;FewSamplesInAttribute&#39;: 49, &#39;ImbalancedAttribute&#39;: 41, &#39;OnlyOneAttributeValue&#39;: 39, &#39;ImbalancedDistInLabel&#39;: 48, &#39;ImbalancedDistInAttribute&#39;: 94}
</pre></div></div>
</div>
<p>Because of dataset reduction according to some anomalies such as <code class="docutils literal notranslate"><span class="pre">NegativeLength</span></code> or <code class="docutils literal notranslate"><span class="pre">InvalideValue</span></code>, the overall statistics can be also updated and it yields another anomalies as shown above (one <code class="docutils literal notranslate"><span class="pre">FarFromLabelMean</span></code> and another <code class="docutils literal notranslate"><span class="pre">FarFromAttrMean</span></code>). These can be refined again through one more refinement cycle as below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">second_refined_dataset</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Correct</span><span class="p">(</span><span class="n">refined_dataset</span><span class="p">,</span> <span class="n">reports</span><span class="o">=</span><span class="n">reports</span><span class="p">)</span>

<span class="n">reports</span> <span class="o">=</span> <span class="n">validate</span><span class="p">(</span><span class="n">second_refined_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Validation report summary: {&#39;errors&#39;: 0, &#39;warnings&#39;: 21, &#39;infos&#39;: 276}
The number of reports per error type:  {}
The number of reports per warning type:  {&#39;FarFromLabelMean&#39;: 12, &#39;FarFromAttrMean&#39;: 9}
The number of reports per info type:  {&#39;FewSamplesInLabel&#39;: 9, &#39;ImbalancedLabels&#39;: 1, &#39;FewSamplesInAttribute&#39;: 49, &#39;ImbalancedAttribute&#39;: 41, &#39;OnlyOneAttributeValue&#39;: 39, &#39;ImbalancedDistInLabel&#39;: 45, &#39;ImbalancedDistInAttribute&#39;: 92}
</pre></div></div>
</div>
<p>We further check that some noisy bounding box annotations of having extreme aspect ratios is well cleaned below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visualizer</span> <span class="o">=</span> <span class="n">Visualizer</span><span class="p">(</span>
    <span class="n">second_refined_dataset</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">ignored_types</span><span class="o">=</span><span class="p">[</span><span class="n">AnnotationType</span><span class="o">.</span><span class="n">mask</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span>
<span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">visualizer</span><span class="o">.</span><span class="n">vis_gallery</span><span class="p">(</span><span class="n">far_from_mean_ids</span><span class="p">[:</span><span class="mi">8</span><span class="p">],</span> <span class="n">far_from_mean_subsets</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/docs_jupyter_notebook_examples_notebooks_12_correct_dataset_11_0.png" src="../../../_images/docs_jupyter_notebook_examples_notebooks_12_correct_dataset_11_0.png" />
</div>
</div>
</section>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Prerequisite">
   Prerequisite
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Download-COCO-2017-validation-dataset">
     Download COCO 2017 validation dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Generate-the-validation-report">
     Generate the validation report
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Visualize-some-anomalies">
     Visualize some anomalies
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Correct-anomalies">
   Correct anomalies
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../../../_sources/docs/jupyter_notebook_examples/notebooks/12_correct_dataset.ipynb.txt">
        <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    <p class="theme-version">
    Built with the
    <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">
        PyData Sphinx Theme
    </a>
    0.12.0.
</p>
  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>